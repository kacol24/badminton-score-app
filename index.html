<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <style>
        .table {
            --bs-table-bg: green;
            --bs-table-color: #fff;
        }

        .table-hover > tbody > tr:hover > * {
            --bs-table-color-state: #fff;
        }

        body {
            background-color: green;
        }

        .scoreboard,
        .court-area,
        caption {
            color: white
        }

        .scoreboard .score {
            /*width: 500px;*/
            text-align: center;
        }

        .play-area {
            /*display: flex;*/
            /*border: 5px solid white;*/
            /*width: 1000px;*/
            position: relative;
        }

        .court-area {
            /*width: 500px;*/
            cursor: pointer;
            user-select: none;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .court-area:first-child {
            /*border-right: 5px solid white;*/
        }

        .court-area .court:first-child {
            /*border-bottom: 5px solid white;*/
        }

        .court {
            /*height: 250px;*/
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            height: 100%;
            border: 5px solid white;
        }

        .court-area .server {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bs-yellow);
            color: white;
            display: block;
            z-index: -1;
            font-size: 0;
        }

        /*.court-area:first-child .court:last-child .server {*/
        /*    top: 5px;*/
        /*    bottom: auto;*/
        /*}*/

        /*.court-area:last-child .court:first-child .server {*/
        /*    left: 5px;*/
        /*    right: auto;*/
        /*}*/

        /*.court-area:last-child .court:last-child .server {*/
        /*    top: 5px;*/
        /*    bottom: auto;*/
        /*    left: 5px;*/
        /*    right: auto;*/
        /*}*/

        .court-area .server {
            display: none;
        }

        .court-area--server .server {
            display: block;
        }

        .win-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, .9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
    </style>
    <!-- Alpine Plugins -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>

    <!-- Alpine Core -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
<div class="container-fluid">
    <div x-data="scoreboard">
        <div class="row">
            <div class="col-lg-9">
                <div class="scoreboard mb-3">
                    <div class="row g-0">
                        <div class="col-6">
                            <div class="score">
                                <h2>Team A</h2>
                                <h1 class="display-1" x-text="scores.teamA">0</h1>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="score">
                                <h2>Team B</h2>
                                <h1 class="display-1" x-text="scores.teamB">0</h1>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="play-area">
                    <div class="row g-0">
                        <div class="col-6">
                            <div class="court-area"
                                 :class="{'court-area--server': server == 'teamA'}"
                                 @click="givePoint('teamA')">
                                <div class="ratio ratio-16x9">
                                    <div>
                                        <div class="court border-end-0">
                                            <template x-if="gameStart">
                                                <div x-text="players.teamA[1]">B</div>
                                            </template>
                                            <template x-if="! gameStart">
                                                <input type="text" class="form-control text-center w-auto"
                                                       style="z-index: 5"
                                                       x-model="players.teamA[1]">
                                            </template>
                                            <template x-if="scores.teamA % 2 == 1">
                                                <div class="server">server</div>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                                <div class="ratio ratio-16x9">
                                    <div>
                                        <div class="court border-top-0 border-end-0">
                                            <template x-if="gameStart">
                                                <div x-text="players.teamA[0]">A</div>
                                            </template>
                                            <template x-if="! gameStart">
                                                <input type="text" class="form-control text-center w-auto"
                                                       style="z-index: 5"
                                                       x-model="players.teamA[0]">
                                            </template>
                                            <template x-if="scores.teamA % 2 == 0">
                                                <div class="server">server</div>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                                <template x-if="! gameStart">
                                    <div class="position-absolute top-0 left-0 w-100 h-100 d-flex align-items-center justify-content-center">
                                        <button class="btn btn-info"
                                                @click="swapPlayers('teamA')">
                                            Swap
                                        </button>
                                    </div>
                                </template>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="court-area"
                                 :class="{'court-area--server': server == 'teamB'}"
                                 @click="givePoint('teamB')">
                                <div class="ratio ratio-16x9">
                                    <div>
                                        <div class="court">
                                            <template x-if="gameStart">
                                                <div x-text="players.teamB[0]">C</div>
                                            </template>
                                            <template x-if="! gameStart">
                                                <input type="text" class="form-control text-center w-auto"
                                                       style="z-index: 5"
                                                       x-model="players.teamB[0]">
                                            </template>
                                            <template x-if="scores.teamB % 2 == 0">
                                                <div class="server">server</div>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                                <div class="ratio ratio-16x9">
                                    <div>
                                        <div class="court border-top-0">
                                            <template x-if="gameStart">
                                                <div x-text="players.teamB[1]">D</div>
                                            </template>
                                            <template x-if="! gameStart">
                                                <input type="text" class="form-control text-center w-auto"
                                                       style="z-index: 5"
                                                       x-model="players.teamB[1]">
                                            </template>
                                            <template x-if="scores.teamB % 2 == 1">
                                                <div class="server">server</div>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                                <template x-if="! gameStart">
                                    <div class="position-absolute top-0 left-0 w-100 h-100 d-flex align-items-center justify-content-center"
                                         style="z-index: 0">
                                        <button class="btn btn-info"
                                                @click="swapPlayers('teamB')">
                                            Swap
                                        </button>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    <template x-if="winner">
                        <div class="win-screen">
                            <div class="text-center">
                                Game won by
                                <h1 class="display-1" x-text="winner"></h1>
                                <p></p>
                                <button class="btn btn-danger" @click="resetGame()">
                                    Reset game
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
                <div class="mt-3">
                    <template x-if="canStartGame()">
                        <div class="text-center d-flex align-items-center justify-content-center text-white mt-3">
                            <h3 style="width: 50px;" x-text="('00' + stopwatch.hours).slice(-2)">00</h3>
                            <h3>:</h3>
                            <h3 style="width: 50px;" x-text="('00' + stopwatch.minutes).slice(-2)">00</h3>
                            <h3>:</h3>
                            <h3 style="width: 50px;" x-text="('00' + stopwatch.seconds).slice(-2)">00</h3>
                        </div>
                    </template>
                    <template x-if="gameStart && ! winner">
                        <div class="scoreboard justify-content-center d-flex">
                            <button class="btn btn-info"
                                    @click="changeShuttle()">
                                Change shuttle
                            </button>
                            <button class="btn btn-warning ms-3"
                                    @click="pauseGame()">
                                Pause game
                            </button>
                            <button class="btn btn-danger ms-3"
                                    @click="resetGame()">
                                Reset game
                            </button>
                        </div>
                    </template>
                    <template x-if="!gameStart && server">
                        <div class="scoreboard justify-content-center">
                            <button class="btn btn-secondary"
                                    @click="resumeGame()">
                                Resume game
                            </button>
                        </div>
                    </template>
                    <template x-if="server == null && canStartGame()">
                        <div class="scoreboard">
                            <div class="row">
                                <div class="col-6">
                                    <div class="score">
                                        <button class="btn btn-primary"
                                                @click="startGame('teamA')">
                                            Start game
                                        </button>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="score">
                                        <button class="btn btn-primary"
                                                @click="startGame('teamB')">
                                            Start game
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="mt-3 mt-lg-0 mb-3" style="max-height: 612px; overflow-y: auto;">
                    <table class="table table-hover table-bordered table-sm mb-0" style="font-size: 75%;">
                        <thead>
                        <tr>
                            <th>Log</th>
                            <th>Score</th>
                            <th>Server</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <template x-for="(log, index) in gameHistory" :key="index">
                            <tr style="font-family: var(--bs-font-monospace);"
                                :class="{
                                    'table-info': log.server === 'teamA',
                                    'table-warning': log.server === 'teamB'
                                 }">
                                <td>
                                    <span x-text="actions[log.action]"></span>
                                </td>
                                <td class="text-nowrap">
                                    <span x-text="log.score.teamA">0</span> : <span x-text="log.score.teamB">0</span>
                                </td>
                                <td class="text-nowrap">
                                    <span x-text="teams[log.server]"></span>
                                </td>
                                <td>
                                    <template x-if="log.action === 'score' && index !== 0">
                                        <button class="btn btn-danger btn-sm py-0 px-1" @click="revertState(index)">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10"
                                                 fill="currentColor" class="bi bi-arrow-counterclockwise"
                                                 viewBox="0 0 16 16">
                                                <path fill-rule="evenodd"
                                                      d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                                                <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
                                            </svg>
                                        </button>
                                    </template>
                                </td>
                            </tr>
                        </template>
                        </tbody>
                    </table>
                </div>
                <p class="text-white mb-0">
                    Shuttle count: <span x-text="shuttleCount">0</span>
                </p>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
<script>
  var teams = {
    'teamA': 'Team A',
    'teamB': 'Team B'
  };
  var actions = {
    'start': 'Game start',
    'score': 'Score',
    'shuttle': 'Change shuttle',
    'correction': 'Correction'
  };
  document.addEventListener('alpine:init', () => {
    let stopwatchTimer;

    Alpine.data('scoreboard', function() {
      return {
        stopwatch: this.$persist({
          hours: 0,
          minutes: 0,
          seconds: 0
        }),
        gamePoint: 21,
        winner: null,
        players: this.$persist({
          teamA: [
            '',
            ''
          ],
          teamB: [
            '',
            ''
          ]
        }),
        scores: this.$persist({
          teamA: 0,
          teamB: 0
        }),
        server: this.$persist(null),
        gameStart: this.$persist(false),
        logs: this.$persist([]),
        shuttleCount: this.$persist(1),

        init() {
          if (this.gameStart) {
            this.checkForWinner();

            if (!this.winner) {
              this.startStopwatch();
            }
          }
        },

        get gameHistory() {
          return this.logs.slice().reverse();
        },

        canStartGame() {
          return this.players.teamA[0]
              && this.players.teamA[1]
              && this.players.teamB[0]
              && this.players.teamB[1];
        },

        startGame(team) {
          this.shuttleCount = 1;
          this.gameStart = true;
          this.server = team;
          this.pushLog('start');
          this.startStopwatch();
        },
        pauseGame() {
          this.gameStart = false;
          this.pauseStopwatch();
        },
        resumeGame() {
          this.gameStart = true;
          this.startStopwatch();
        },

        changeShuttle() {
          this.shuttleCount++;
          this.pushLog('shuttle');
        },
        revertState(index) {
          var state = this.gameHistory[index];
          this.scores.teamA = state.score.teamA;
          this.scores.teamB = state.score.teamB;
          this.server = state.server;
          this.players = {
            teamA: state.players.teamA,
            teamB: state.players.teamB
          };
          this.pushLog('correction');
        },

        swapPlayers(team) {
          this.players[team].reverse();
        },

        givePoint(forTeam) {
          if (this.server == null || !this.gameStart) {
            return;
          }
          if (forTeam === 'teamA') {
            this.scores.teamA++;
          } else if (forTeam === 'teamB') {
            this.scores.teamB++;
          }
          if (this.server === forTeam) {
            this.swapPlayers(forTeam);
          }
          this.server = forTeam;

          this.pushLog();

          if (this.scores.teamA >= 20 || this.scores.teamB >= 20) {
            this.checkForWinner();
          }
        },

        checkForWinner() {
          this.checkForDeuce();

          if (this.scores.teamA - this.scores.teamB >= 2 && this.scores.teamA >= this.gamePoint) {
            this.winner = 'Team A';
          } else if (this.scores.teamB - this.scores.teamA >= 2 && this.scores.teamB >= this.gamePoint) {
            this.winner = 'Team B';
          }

          this.pauseStopwatch();
        },

        checkForDeuce() {
          if (this.scores.teamA === this.scores.teamB) {
            this.gamePoint += 1;
          }
        },

        startStopwatch() {
          stopwatchTimer = setInterval(() => {
            this.stopwatch.seconds++;
            if (this.stopwatch.seconds === 60) {
              this.stopwatch.minutes++;
              this.stopwatch.seconds = 0;
            }
            if (this.stopwatch.minutes === 60) {
              this.stopwatch.hours++;
              this.stopwatch.minutes = 0;
            }
          }, 1000);
        },
        pauseStopwatch() {
          clearInterval(stopwatchTimer);
        },
        resetStopwatch() {
          this.stopwatch.hours = 0;
          this.stopwatch.minutes = 0;
          this.stopwatch.seconds = 0;
        },

        async pushLog(action = 'score') {
          await this.$nextTick();
          this.logs.push({
            action: action,
            timestamp: this.stopwatch,
            server: this.server,
            score: {
              teamA: this.scores.teamA,
              teamB: this.scores.teamB
            },
            players: {
              teamA: this.players.teamA.slice(),
              teamB: this.players.teamB.slice()
            }
          });
        },

        resetGame() {
          this.pauseStopwatch();
          this.resetStopwatch();

          this.scores.teamA = 0;
          this.scores.teamB = 0;
          this.shuttleCount = 0;
          this.server = null;
          this.gameStart = false;
          this.logs = [];
          this.gamePoint = 21;
          this.winner = null;
        }
      };
    });
  });
</script>
</body>
</html>
